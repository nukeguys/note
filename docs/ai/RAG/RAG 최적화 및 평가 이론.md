# RAG 최적화 및 평가 이론

## 1. 청킹 전략 (Chunking Strategies)

단순한 텍스트 분할을 넘어, 검색의 '단위'를 결정하는 핵심 단계입니다.

- **Fixed-size Chunking (고정 크기):** 설정한 토큰/문자 수만큼 기계적으로 자름. (구현이 쉽지만 문맥이 끊김)
- **Recursive Character Chunking (재귀적 분할):** 줄바꿈(`\n`), 마침표(`.`), 공백(` `) 순으로 우선순위를 두어 최대한 의미 단위로 자름. (표준 방식)
- **Semantic Chunking (의미론적 분할):** 문장 간의 벡터 유사도를 계산하여 주제가 바뀌는 지점에서 분할. (정확도 극대화)
- **Context Overlap (중복 허용):** 조각 사이의 경계에서 앞뒤 내용을 일부 중복시켜 문맥 단절 방지. (보통 10~20% 설정)

## 2. 질문 변형 및 확장 (Query Transformation)

사용자의 불완전한 질문을 AI가 검색하기 좋은 형태로 재가공하는 기술입니다.

- **Multi-Query Retrieval:** 하나의 질문을 LLM이 여러 관점의 질문으로 다시 생성하여 검색 범위(Recall) 확장.
- **HyDE (Hypothetical Document Embeddings):** 질문에 대한 '가상의 답변'을 먼저 쓰고, 그 답변으로 벡터 DB를 검색. (질문-문서 간 간극 해소)
- **Step-back Prompting:** 구체적인 질문에서 더 넓은 개념의 질문을 파생시켜 배경 지식까지 검색.
- **Sub-query Decomposition:** 복합적인 질문을 여러 개의 쉬운 하위 질문으로 쪼개어 각각 검색 후 통합.

## 3. 리랭킹 (Reranking)

1차로 검색된 후보군 중에서 진짜 정답과 가까운 순서대로 순위를 재조정합니다.

- **Cross-Encoder 모델:** 질문과 문서 조각을 동시에 읽고 정밀하게 점수 매김 (BGE-Reranker 등).
- **Bi-Encoder(벡터 검색)의 한계 보완:** 속도는 빠르지만 세밀함이 부족한 벡터 검색의 단점을 보완하여 최종 답변 품질 결정.

## 4. RAG 평가 지표: RAG Triad (트라이어드)

시스템이 얼마나 잘 작동하는지 측정하는 3대 핵심 지표입니다.

1. **Context Relevance (맥락 관련성):** 질문에 대해 검색된 문서 조각들이 정말 관련이 있는가?
2. **Groundedness/Faithfulness (충실성):** 생성된 답변이 검색된 문서 내용에만 기반하고 있는가? (환각 방지)
3. **Answer Relevance (답변 관련성):** 최종 답변이 사용자의 질문 의도에 부합하는가?

## 5. 단계별 추천 전문 라이브러리 (Advanced Tools)

| 분류            | 추천 도구                                 | 특징                                            |
| :-------------- | :---------------------------------------- | :---------------------------------------------- |
| **청킹/전처리** | `Unstructured`, `LangChain TextSplitters` | PDF, 표, 이미지 속 텍스트 정밀 추출 및 분할     |
| **쿼리 확장**   | `LlamaIndex QueryTransform`               | 질문 재작성, 라우팅, 하위 질문 생성 전용 모듈   |
| **평가 (Eval)** | `Ragas`, `TruLens`                        | LLM을 이용해 시스템의 정확도를 자동 점수로 채점 |
| **가시화**      | `Chonkie`, `LangSmith`                    | 청킹 결과 및 데이터 흐름을 시각적으로 모니터링  |
